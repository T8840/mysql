(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{437:function(s,a,t){"use strict";t.r(a);var r=t(2),e=Object(r.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("MySQL的日志种类非常多，包括通用查询日志、慢查询日志、错误日志、二进制日志、中继日志、重做日志和回滚日志.")]),s._v(" "),a("h2",{attrs:{id:"通用查询日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通用查询日志"}},[s._v("#")]),s._v(" 通用查询日志")]),s._v(" "),a("p",[s._v("通用查询日志记录了所有用户的连接开始时间和截止时间，以及发给MySQL数据库服务器的所有SQL指令。\n当我们的数据发生异常时，开启通用查询日志，还原操作时的具体场景，可以帮助我们准确定位问题。")]),s._v(" "),a("h3",{attrs:{id:"开启通用查询日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开启通用查询日志"}},[s._v("#")]),s._v(" 开启通用查询日志")]),s._v(" "),a("p",[s._v("通过设置系统变量的值，来开启通用查询日志，并且指定通用查询日志的文件夹和文件名为“H:\\mytest.log”。这个操作如下：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GLOBAL")]),s._v(" general_log "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ON'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" affected "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" @"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@global.general_log_file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'H:\\mytest.log'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" affected "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.02")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n")])])]),a("p",[s._v("确认是否生效：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" VARIABLES "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%general%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("------------------+--------------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Value")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("------------------+--------------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" general_log "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 通用查询日志开启")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" general_log_file "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" H:mytest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 日志名称也改过了")]),s._v("\n\n")])])]),a("h3",{attrs:{id:"查看通用查询日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看通用查询日志"}},[s._v("#")]),s._v(" 查看通用查询日志")]),s._v(" "),a("h3",{attrs:{id:"删除通用查询日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除通用查询日志"}},[s._v("#")]),s._v(" 删除通用查询日志")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GLOBAL")]),s._v(" general_log "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'OFF'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 关闭通用查询日志")]),s._v("\n")])])]),a("h2",{attrs:{id:"慢查询日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#慢查询日志"}},[s._v("#")]),s._v(" 慢查询日志")]),s._v(" "),a("p",[s._v("慢查询日志用来记录执行时间超过指定时长的查询。它的主要作用是，帮助我们发现那些执行时间特别长的SQL查询，并且有针对性地进行优化，从而提高系统的整体效率。当我们的数据库服务器发生阻塞、运行变慢的时候，检查一下慢查询日志，找到那些慢查询，对解决问题很有帮助。")]),s._v(" "),a("p",[s._v("慢查询日志是由MySQL的配置文件进行控制的。  MySQL的配置文件“my.ini”, 重启才能生效。\n配置文件中关于慢查询日志变量的相关设定：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("slow"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("query"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("log"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 表示开启慢查询日志，系统将会对慢查询进行记录。")]),s._v("\nslow_query_log_file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GJTECH-PC-slow.log"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('-- 表示慢查询日志的名称是"GJTECH-PC-slow.log"。这里没有指定文件')]),s._v("\nlong_query_time"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 表示慢查询的标准是查询执行时间超过10秒")]),s._v("\n")])])]),a("p",[s._v("控制慢查询日志的还有一个系统变量：min_examined_row_limit。"),a("br"),s._v("\n这个变量的意思是，查询扫描过的最少记录数。这个变量和查询执行时间，共同组成了判别一个查询是否是慢查询的条件。如果查询扫描过的记录数大于等于这个变量的值，并且查询执行时间超过long_query_time的值，那么，这个查询就被记录到慢查询日志中；反之，则不被记录到慢查询日志中。")]),s._v(" "),a("h2",{attrs:{id:"错误日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#错误日志"}},[s._v("#")]),s._v(" 错误日志")]),s._v(" "),a("p",[s._v("错误日志记录了MySQL服务器启动、停止运行的时间，以及系统启动、运行和停止过程中的诊断信息，包括错误、警告和提示等。当我们的数据库服务器发生系统故障时，错误日志是发现问题、解决故障的首选。"),a("br"),s._v("\n错误日志默认是开启的。我们可以在MySQL的配置文件“my.ini”中配置它：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Error Logging.")]),s._v("\nlog"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("error"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GJTECH-PC.err"')]),s._v("\n\n")])])]),a("h2",{attrs:{id:"二进制日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二进制日志"}},[s._v("#")]),s._v(" 二进制日志")]),s._v(" "),a("p",[s._v("二进制日志主要记录数据库的更新事件，比如创建数据表、更新表中的数据、数据更新所花费的时长等信息。通过这些信息，我们可以再现数据更新操作的全过程。而且，由于日志的延续性和时效性，我们还可以利用日志，完成无损失的数据恢复和主从服务器之间的数据同步。"),a("br"),s._v("\n可以说，二进制日志是进行数据恢复和数据复制的利器。")]),s._v(" "),a("h2",{attrs:{id:"中继日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#中继日志"}},[s._v("#")]),s._v(" 中继日志")]),s._v(" "),a("p",[s._v("中继日志只在主从服务器架构的从服务器上存在。从服务器为了与主服务器保持一致，要从主服务器读取二进制日志的内容，并且把读取到的信息写入本地的日志文件中，这个从服务器本地的日志文件就叫中继日志。然后，从服务器读取中继日志，并根据中继日志的内容对从服务器的数据进行更新，完成主从服务器的数据同步。")]),s._v(" "),a("p",[s._v("搭建好主从服务器之后，中继日志默认会保存在从服务器的数据目录（C:\\ProgramData\\MySQL\\MySQL Server 8.0\\Data）下，文件名的格式是：从服务器名-relay-bin.序号。")]),s._v(" "),a("p",[s._v("中继日志还有一个索引文件：从服务器名-relay-bin.index，用来定位当前正在使用的中继日志。")]),s._v(" "),a("p",[s._v("中继日志与二进制日志的格式相同，可以用mysqlbinlog工具进行查看。")]),s._v(" "),a("h2",{attrs:{id:"回滚日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#回滚日志"}},[s._v("#")]),s._v(" 回滚日志")]),s._v(" "),a("p",[s._v("回滚日志的作用是进行事务回滚。"),a("br"),s._v("\n当事务执行的时候，回滚日志中记录了事务中每次数据更新前的状态。当事务需要回滚的时候，可以通过读取回滚日志，恢复到指定的位置。另一方面，回滚日志也可以让其他的事务读取到这个事务对数据更改之前的值，从而确保了其他事务可以不受这个事务修改数据的影响。")]),s._v(" "),a("h2",{attrs:{id:"重做日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#重做日志"}},[s._v("#")]),s._v(" 重做日志")]),s._v(" "),a("p",[s._v("重做日志是存储在磁盘上的一种日志文件，主要有2个作用。")]),s._v(" "),a("ol",[a("li",[s._v("在系统遇到故障的恢复过程中，可以修复被未完成的事务修改的数据。")]),s._v(" "),a("li",[s._v("MySQL为了提高数据存取的效率，减少磁盘操作的频率，对数据的更新操作不会立即写到磁盘上，而是把数据更新先保存在内存中，积累到一定程度，再集中进行磁盘读写操作。这样就存在一个问题：一旦出现宕机或者停电等异常情况，内存中保存的数据更新操作可能会丢失。这个时候就可以通过读取重做日志中记录的数据更新操作，把没来得及写到磁盘上的数据更新写到磁盘上，确保数据的完整性。")])])])}),[],!1,null,null,null);a.default=e.exports}}]);